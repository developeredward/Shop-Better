<%- include('../partials/admin-navbar', { title: 'BetterShop Admin', currentPath }) %>

<section class="edit-product-page">
  <div class="form-container">
    <h2>üõ†Ô∏è Edit Product</h2>

    <form action="/admin/products/edit/<%= product._id %>" method="POST" enctype="multipart/form-data">
      <div class="form-group">
        <label>Name:</label>
        <input type="text" name="name" value="<%= product.name %>" required>
      </div>

      <div class="form-group">
        <label>Description:</label>
        <textarea name="description" rows="4" required><%= product.description %></textarea>
      </div>

      <div class="form-group">
        <label>Price ($):</label>
        <input type="number" step="0.01" name="price" value="<%= product.price %>" required>
      </div>

      <div class="form-group">
        <label>Category:</label>
        <select name="category" id="category-select" required>
          <% categories.forEach(cat => { %>
            <option value="<%= cat %>" <%= product.category === cat ? "selected" : "" %>><%= cat %></option>
          <% }) %>
        </select>
      </div>

      <div class="form-group">
        <label>Tags:</label>
        <div id="tags-list" class="checkbox-group">
          <% (tagsByCategory[product.category] || []).forEach(tag => { %>
            <label><input type="checkbox" name="tags" value="<%= tag %>" <%= product.tags.includes(tag) ? "checked" : "" %>> <%= tag %></label>
          <% }) %>
        </div>
      </div>

      <div class="form-group checkbox-inline">
        <label><input type="checkbox" name="isFeatured" value="1" <%= product.isFeatured ? "checked" : "" %>> Featured Product</label>
        <label><input type="checkbox" name="isFlashSale" value="1" <%= product.isFlashSale ? "checked" : "" %>> Flash Sale</label>
        <label><input type="checkbox" name="discountActive" value="1" <%= product.discountActive ? "checked" : "" %>> Has Discount</label>
      </div>

      <div class="form-group">
        <label>Discount Percent (%):</label>
        <input type="number" name="discountPercent" value="<%= product.discountPercent || 0 %>">
      </div>

      <% if (product.imageUrl) { %>
        <div class="form-group">
          <label>Current Image:</label><br>
          <img src="<%= product.imageUrl %>" alt="Product Image" class="preview-img">
        </div>
      <% } %>

      <div class="form-group">
        <label>Upload New Image:</label>
        <input type="file" name="image">
      </div>

      <button type="submit" class="btn-submit">‚úÖ Update Product</button>
    </form>
  </div>
</section>

<script>
  const tagsByCategory = JSON.parse(`<%- JSON.stringify(tagsByCategory).replace(/</g, '\\u003c') %>`);
  const tagsList = document.getElementById("tags-list");
  const categorySelect = document.getElementById("category-select");

  categorySelect.addEventListener("change", () => {
    const selected = categorySelect.value;
    const tags = tagsByCategory[selected] || [];
    tagsList.innerHTML = tags.map(tag => `
      <label><input type="checkbox" name="tags" value="${tag}"> ${tag}</label>
    `).join("");
  });
</script>

<%- include("../partials/footer") %>
